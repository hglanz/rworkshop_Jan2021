---
title: "Data Wrangling"
subtitle: "Module 2"  
author: "Hunter Glanz & Kelly Bodwin"

output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(tidyverse)
library(palmerpenguins)
library(flair)
```

```{r xaringan-themer, include=FALSE}
library(xaringanthemer)
solarized_light()
```

class: center, middle

### Lots of different backgrounds here!

# Why are you here? Why R? Why now?

---

# Why should you learn R?

* R is free, R improves, R has existed for a long time
* The support system for R is actually very good!
  * Many free textbooks online
  * Tons of announcements and content on Twitter
  * [StackOverflow](https://stackoverflow.com/) for coding questions
  
.center[![](https://www.thezenteacher.com/wp-content/uploads/2018/11/drinking-from-the-firehose.jpeg)]

---

# But why should YOU learn R?

* R and R Markdown will save you TONS of time. Long term thinking is key.

--

  * You can easily tweak your code if you need to do another analysis
  
--

  * Remembering what drop-down menu something is in two years from now in a different program will be hard
  
--

  * Remembering to copy-and-paste your updated plots/analysis into your word processor is a pain and error prone
  
--

.center[*Your closest collaborator is you from six months ago, but you no longer answer emails* - Mark Holder]


```{r, out.width = "35%", echo = FALSE, fig.align='center'}
knitr::include_graphics("BadOldCodeTweet.PNG")
```
---

# Good Coding Habits


* [Good coding style](https://style.tidyverse.org/) -- Use a consistent style!

--

* Use some form of Git

--

* Take advantage of R Markdown, R Shiny, and R projects where appropriate

--

.center[*Reproducibility is key!*]

---

# What this workshop is

* Some of...

.center[![](https://paulvanderlaken.files.wordpress.com/2017/07/tidyverse1.png)]

* Plus a few others: rmarkdown, gganimate, leaflet

---

# Let's Get Started

* [Installing R](https://www.r-project.org/)

  * Follow the "Getting Started" directions to download and install R
  
--

* [Installing RStudio](https://www.rstudio.com/products/rstudio/)

  * Click on "RStudio Desktop" and follow the directions to download and install the **open source edition** of RStudio Desktop
  
---

# Collecting the workshop materials

* Open RStudio

* In the Console pane (bottom left or just left by default) type the following and hit Enter

.center[**install.packages("usethis")**]

* Now, in the same Console pane, type the following and hit Enter

.center[**usethis::use_course("hglanz/rworkshop_Jan2021")**]

* You should see a new RStudio session open and come to the front of your screen except now, in the very top right corner of RStudio, you should see that light blue icon next to **rworkshop**

---

# What did we just do?!

* You installed Base R

* You installed RStudio

* You installed your first package: `usethis`

* You obtained all of our workshop materials (to your Desktop) via some functionality of the `usethis` package

* You opened an R project file called *rworkshop* (more on this later)

* **NOTE**: the `usethis` package is not necessary for work in R/RStudio, but is a very convenient tool for organizing and disseminating materials.

---

# Working with R through RStudio

* R is the language

--

* RStudio is the IDE (integrated development environment) -- not required to work with R, but highly recommended

--

---

class: center, middle

# Reading data

<img src="https://readr.tidyverse.org/logo.png" width=300>

---

# Where is your data stored?

* On your computer?

* On a website?

* On "the cloud"? (Dropbox, Google Drive, ...)

# How is your data stored?

* An Excel spreadsheet?

* A Googlesheets spreadsheet?

* A text file?

* A JSON/SQL/WTF file?

---

# Easy mode: Reading csvs

A file of **comma-separated values (csv)** looks like this:

```
Name, Age, Favorite Color,
Susie, 5, Blue
Kelly, 30, Teal
Hunter, 32, Goldenrod
```


> Excel spreadsheets can easily be saved as *csv*'s!

---

# Reading csvs

Option 1:  Base R

```{r, echo = FALSE}
decorate('
  read.csv(...)
',
eval = FALSE) %>% 
    flair_rx('\\.(?=c)') %>%
  flair_funs(color = "teal")
```

Option 2: The `readr` package.  (Recommended!)


```{r, echo = FALSE}
decorate('
  library(readr)
  read_csv(...)
',
eval = FALSE) %>% 
    flair_fixed('_') %>%
  flair_funs(color = "teal")
```


---
class: center, middle, invert

# Step one: Install the `readr` package

```{r, echo = FALSE}
decorate('
  install.packages("readr")
',
eval = FALSE) %>% 
    flair_fixed('"') %>%
    flair_fixed("readr", color = "cornflowerblue") %>%
  flair_funs(color = "teal")
```

> DO NOT PUT THIS IN YOUR R MARKDOWN FILE!!!

> Use the **console**. :)

---


## If the file is in your **R Project** folder:
(In a subfolder called "data")

```{r, echo = FALSE}
decorate('
  dat <- read_csv("/data/my_data.csv")
  ', 
  eval = FALSE) %>%
  flair_fixed("read_csv", color = "teal") %>%
  flair_fixed("my_data.csv")
```

The `here` package contains some very handy functions for obtaining paths and locations of files relative to a project's root folder!

## If the file is elsewhere on your computer:


```{r, echo = FALSE}
decorate('
  dat <- read_csv("/Users/kbodwin/Dropbox/Data/my_data.csv")
  ',
  eval = FALSE)  %>%
  flair_fixed("read_csv", color = "teal") %>%
  flair_fixed("my_data.csv")
```

## If the file is on the web:


```{r, echo = FALSE}
decorate('
  dat <- read_csv("www.kelly-bodwin.com/my_data.csv")
  ',
  eval = FALSE)  %>%
  flair_fixed("read_csv", color = "teal") %>%
  flair_fixed("my_data.csv")
```

---
class: center, middle, invert

# Prerequisite:  The Pipe  `%>%`

---

# The Pipe

```{r, echo = FALSE}
decorate('penguins %>% summary()', eval = FALSE) %>% 
  flair_fixed("%>%") %>% 
  flair_funs(color = "teal")
```

is the same as

```{r, echo = FALSE}
decorate('summary(penguins)', eval = FALSE) %>% 
  flair_funs(color = "teal")
```


* Originally part of the `magrittr` package

* Central to the philosophy and design of the *tidyverse*
---
# Idea 1: Analysis steps should flow sequentially.
# Idea 2: Code should read a bit like an English sentence.

What do you think the following will do?

```{r, eval = FALSE}
penguins %>%
  filter(bill_length_mm > 40) %>%
  arrange(body_mass_g)
```


---
class: center, middle, invert

# Understanding your dataset

---

# Before you start anything, you should know:

* How your data was collected, and by whom. (Hint: Look for the **documentation**.)

* What the variable names are, and what type each is:

    + Numeric?  Integer or double?
    + Non-Numeric?  Factor or string?
    + Something special (e.g. dates, lists, other weird stuff)
    
* How many observations there are, and if there is any missing data.

---

Use *functions* in R to get some more information:

```{r, echo = FALSE}
demo_code('
  str(iris)
  summary(iris)
  ') %>%
  hlt_funs(color = "teal") %>%
  hlt_fixed("iris")
  
```

---
class: center, middle

# Your turn!

---

class: center, middle

## In `Practice.Rmd`, examine your `cereals` dataset.
## Write 3-4 sentences summarizing the important information about the data.

## Think: What information would **you** be interested in, if you were reading an article using this data?


---

class: center, middle, invert

# Cleaning and transforming data

<img src="https://d33wubrfki0l68.cloudfront.net/071952491ec4a6a532a3f70ecfa2507af4d341f9/c167c/images/hex-dplyr.png" width=300>


---
class: center, middle, invert

# Prerequisite:  The Pipe  `%>%`

---

# The Pipe

```{r, echo = FALSE}
demo_code('iris %>% summary()', eval = FALSE) %>% 
  hlt_fixed("%>%") %>% 
  hlt_funs(color = "teal")
```

is the same as

```{r, echo = FALSE}
demo_code('summary(iris)', eval = FALSE) %>% 
  hlt_funs(color = "teal")
```


* Originally part of the `magrittr` package

* Central to the philosophy and design of the *tidyverse*
---
# Idea 1: Analysis steps should flow sequentially.
# Idea 2: Code should read a bit like an English sentence.

What do you think the following will do?

```{r, eval = FALSE}
mtcars %>%
  filter(hp > 100) %>%
  arrange(mpg)
```

---

# Summarizing

```{r, echo = FALSE}
demo_code('
iris %>%
  summary()
  ') %>% hlt_fixed("y(")
```

---
# Summarizing

```{r, echo = FALSE}
demo_code('
iris %>%
  summarize(mean(Petal.Length))
  ') %>% 
  hlt_fixed("ize(") %>% 
  hlt_fixed("mean", color = "teal") %>%
  hlt_fixed("Petal.Length", color = "cornflowerblue")
```

---

# Many variables?  Many summary statistics?
## No problemo

```{r, echo = FALSE}
demo_code('
iris %>%
  summarize_at(vars(Petal.Length, Petal.Width),
            funs(mean, median))
  ') %>% 
  hlt_fixed("_at") %>%
  hlt_regexp("(mean)|(median)", color = "teal") %>%
  hlt_regexp("(Petal.Length)|(Petal.Width)", color = "cornflowerblue") %>%
  hlt_regexp("(vars)|(funs)", color = "darkred")
```
---
class: center, middle, invert

# Your Turn!

---
class: center, middle, invert
# In `Practice.Rmd`, find some summary statistics for the calories and sugar content of the cereals.

---
# Making new variables

Verb: `mutate()`

The dataset gets *mutated* to include a new variable.

```{r}
iris %>%
  mutate(
    Petal.Size = Petal.Length*Petal.Width
  ) %>%
  str()
```

---

Cool, let's look at our new variable!

```{r, error = TRUE}
iris %>%
  summarize_at(vars(Petal.Size), funs(mean, median))
```

OH NO!

**What happened here?**

---

class: center, middle

# We calculated a new variable, but didn't save our changes.

---

```{r, echo = FALSE}
demo_code('
iris_new <- iris %>%
          mutate(
            Petal.Size = Petal.Length*Petal.Width
          )
          
iris_new$Petal.Size
') %>% hlt_fixed("iris_new <- ")


```

---
# Ordering

Verb: `arrange()`

We **arrange** the dataset in order of a particular variable.

```{r}
iris_new %>% 
  arrange(Petal.Width)
```

---

## Related: `top_n`

```{r}
iris_new %>%
  top_n(3, Petal.Width)
```

---

# Quick check in!

Remember,

```{r, eval = FALSE}
iris_new %>%
  top_n(3, Petal.Width)
```

is the same as

```{r, eval = FALSE}
top_n(iris_new, 3, Petal.Width)
```

or

```{r, eval = FALSE}
top_n(x = iris_new, n = 3, wt = Petal.Width)
```

---

# Selecting

Verb: `select()`

We **select** which variables we would like to remain in the dataset.

```{r, eval = FALSE}
iris_new %>%
  select(Species, Petal.Size) %>%
  arrange(Petal.Size)
```

---

# Filtering

Verb: `filter()`

We **filter** which variables we would like to remain in the dataset.

```{r, eval = FALSE}
iris_new %>%
  select(Species, Petal.Size) %>%
  filter(Species == "setosa") %>%
  arrange(Petal.Size)
```

---